# 開発計画：LangGraph搭載 自律型リサーチエージェント

## 1. ドキュメント情報

- **文書名**: 開発計画
- **バージョン**: 1.1
- **作成日**: 2024-12-27
- **最終更新日**: 2025-02-01
- **対象システム**: LangGraph搭載 自律型リサーチエージェント
- **参照文書**: 要求定義書、基本設計書、詳細設計書、API仕様書、データモデル定義書、テスト仕様書、プロンプト設計書

---

## 2. 開発計画概要

### 2.1 開発方針

- **段階的開発**: 機能を段階的に実装し、各フェーズで動作確認
- **テスト駆動**: 各機能の実装と同時にテストを作成
- **反復的改善**: フィードバックに基づいて継続的に改善

### 2.2 開発期間

- **総開発期間**: 約4-6週間（1人あたり）
- **フェーズ1（基盤構築）**: 1週間
- **フェーズ2（コア機能）**: 2週間
- **フェーズ3（統合・API）**: 1週間
- **フェーズ4（最適化・拡張）**: 1-2週間

### 2.3 開発チーム構成（想定）

- **開発者**: 1-2名
- **テスト担当**: 1名（兼任可）
- **レビューア**: 1名（兼任可）

---

## 3. 開発フェーズ

### フェーズ1: 基盤構築（Week 1）

**目的**: プロジェクトの基盤を構築し、基本的なデータモデルと設定を実装

#### 3.1.1 タスク一覧

| タスクID | タスク名 | 機能ID | 優先度 | 工数（時間） | 依存関係 |
|---------|---------|--------|--------|------------|---------|
| T1-001 | プロジェクトセットアップ | - | 高 | 2 | - |
| T1-002 | データモデル実装 | F001 | 高 | 4 | T1-001 |
| T1-003 | 設定管理実装 | - | 高 | 2 | T1-001 |
| T1-004 | ロギング機能実装 | F012 | 中 | 2 | T1-001 |
| T1-005 | ステートスキーマ定義 | F001 | 高 | 3 | T1-002 |
| T1-006 | ユニットテスト（データモデル） | - | 高 | 3 | T1-002 |

**合計工数**: 約16時間（2日）

#### 3.1.2 詳細タスク

**T1-001: プロジェクトセットアップ**
- ディレクトリ構造の作成
- `requirements.txt` / `pyproject.toml`の作成
- 仮想環境のセットアップ
- `.env_example`の作成
- `.gitignore`の設定

**T1-002: データモデル実装**
- `ResearchPlan`クラスの実装
- `SearchResult`クラスの実装
- `ResearchReport`クラスの実装
- バリデーションルールの実装

**T1-003: 設定管理実装**
- `Settings`クラスの実装
- 環境変数の読み込み
- `.env`ファイルのサポート

**T1-004: ロギング機能実装**
- `setup_logger()`関数の実装
- ログフォーマットの設定
- LangSmith連携（オプション）

**T1-005: ステートスキーマ定義**
- `ResearchState` TypedDictの実装
- 型ヒントの完全な記述

**T1-006: ユニットテスト（データモデル）**
- ResearchPlanのテスト
- SearchResultのテスト
- バリデーションテスト

#### 3.1.3 マイルストーン

- **M1-1**: プロジェクトセットアップ完了（Day 1）
- **M1-2**: データモデル実装完了（Day 2）
- **M1-3**: 基盤構築完了（Day 3）

---

### フェーズ2: コア機能実装（Week 2-3）

**目的**: 主要なノード機能とツールを実装し、基本的なリサーチフローを動作させる

#### 3.2.1 タスク一覧

| タスクID | タスク名 | 機能ID | 優先度 | 工数（時間） | 依存関係 |
|---------|---------|--------|--------|------------|---------|
| T2-001 | プロンプトテンプレート実装 | - | 高 | 3 | T1-001 |
| T2-002 | 検索ツール実装 | F007 | 高 | 4 | T1-002, T1-003 |
| T2-003 | スクレイピングツール実装 | F008 | 中 | 3 | T1-002 |
| T2-004 | Supervisorノード実装 | F002 | 高 | 8 | T1-005, T2-001 |
| T2-005 | Researcherノード実装 | F003 | 高 | 6 | T1-005, T2-002 |
| T2-006 | Writerノード実装 | F004 | 高 | 6 | T1-005, T2-001 |
| T2-007 | Reviewerノード実装 | F005 | 高 | 6 | T1-005, T2-001 |
| T2-008 | エラーハンドリング実装 | F011 | 高 | 4 | T2-004, T2-005 |
| T2-009 | グラフ構築・ルーティング実装 | F006 | 高 | 6 | T2-004, T2-005, T2-006, T2-007 |
| T2-010 | ユニットテスト（ノード） | - | 高 | 8 | T2-004, T2-005, T2-006, T2-007 |
| T2-011 | 統合テスト（基本フロー） | - | 高 | 4 | T2-009 |

**合計工数**: 約58時間（7-8日）

#### 3.2.2 詳細タスク

**T2-001: プロンプトテンプレート実装**
- Supervisorプロンプト
- Writerプロンプト
- Reviewerプロンプト

**T2-002: 検索ツール実装**
- Tavily検索ツールの実装
- リトライロジックの実装
- エラーハンドリング

**T2-003: スクレイピングツール実装**
- Webスクレイピングツールの実装
- URL検証
- コンテンツ抽出

**T2-004: Supervisorノード実装**
- 計画生成機能
- ルーティング決定機能
- LLM呼び出しとJSONパース

**T2-005: Researcherノード実装**
- 検索実行機能
- 重複除去機能
- 結果の整理

**T2-006: Writerノード実装**
- ドラフト生成機能
- マークダウン抽出
- フィードバックの考慮

**T2-007: Reviewerノード実装**
- ドラフト評価機能
- フィードバック生成
- 承認/却下判定

**T2-008: エラーハンドリング実装**
- リトライデコレータ
- エラーハンドリングデコレータ
- ノードエラー時の処理

**T2-009: グラフ構築・ルーティング実装**
- `build_graph()`関数の実装
- ルーティング関数の実装
- エッジの設定

**T2-010: ユニットテスト（ノード）**
- 各ノードのテスト
- ツールのテスト

**T2-011: 統合テスト（基本フロー）**
- 基本的なリサーチフローのテスト
- エラーハンドリングのテスト

#### 3.2.3 マイルストーン

- **M2-1**: ツール実装完了（Week 2, Day 1-2）
- **M2-2**: ノード実装完了（Week 2, Day 3-5）
- **M2-3**: グラフ構築完了（Week 3, Day 1）
- **M2-4**: 基本フロー動作確認（Week 3, Day 2-3）

---

### フェーズ3: 統合・API実装（Week 4）

**目的**: API実装とチェックポイント機能を追加し、システムを完成させる

#### 3.3.1 タスク一覧

| タスクID | タスク名 | 機能ID | 優先度 | 工数（時間） | 依存関係 |
|---------|---------|--------|--------|------------|---------|
| T3-001 | チェックポイント機能実装 | F009 | 中 | 4 | T2-009 |
| T3-002 | Human-in-the-Loop実装 | F010 | 中 | 4 | T2-009, T3-001 |
| T3-003 | APIスキーマ実装 | - | 高 | 2 | T1-002 |
| T3-004 | FastAPI実装 | - | 高 | 8 | T2-009, T3-003 |
| T3-005 | APIテスト実装 | - | 高 | 4 | T3-004 |
| T3-006 | エンドツーエンドテスト | - | 高 | 4 | T3-004 |
| T3-007 | ドキュメント整備 | - | 中 | 4 | T3-004 |

**合計工数**: 約30時間（4日）

#### 3.3.2 詳細タスク

**T3-001: チェックポイント機能実装**
- MemorySaver実装
- RedisCheckpointer実装（オプション）
- チェックポイントの保存・復元

**T3-002: Human-in-the-Loop実装**
- 中断ポイントの設定
- 人間入力の処理
- 再開機能

**T3-003: APIスキーマ実装**
- ResearchRequestモデル
- ResearchResponseモデル
- ProgressInfoモデル
- ResearchStatisticsモデル

**T3-004: FastAPI実装**
- POST /research
- GET /research/{id}
- GET /research/{id}/status
- POST /research/{id}/resume
- DELETE /research/{id}
- GET /health

**T3-005: APIテスト実装**
- 各エンドポイントのテスト
- エラーハンドリングのテスト

**T3-006: エンドツーエンドテスト**
- 実際のテーマでのレポート生成
- 品質評価

**T3-007: ドキュメント整備**
- README.mdの作成
- APIドキュメントの整備
- 使用例の作成

#### 3.3.3 マイルストーン

- **M3-1**: チェックポイント機能完了（Day 1）
- **M3-2**: API実装完了（Day 2-3）
- **M3-3**: システム完成（Day 4）

---

### フェーズ4: 最適化・拡張（Week 5-6）

**目的**: パフォーマンス最適化、機能拡張、本番環境対応

#### 3.4.1 タスク一覧

| タスクID | タスク名 | 機能ID | 優先度 | 工数（時間） | 依存関係 |
|---------|---------|--------|--------|------------|---------|
| T4-001 | パフォーマンス最適化 | - | 中 | 6 | T3-004 |
| T4-002 | 並列検索実装 | F003 | 低 | 4 | T2-005 |
| T4-003 | キャッシュ機能実装 | - | 低 | 4 | T2-002 |
| T4-004 | ストリーミング出力実装 | - | 低 | 4 | T3-004 |
| T4-005 | 認証機能実装 | - | 中 | 4 | T3-004 |
| T4-006 | レート制限実装 | - | 中 | 3 | T3-004 |
| T4-007 | Webhook実装 | - | 低 | 4 | T3-004 |
| T4-008 | 監視・アラート設定 | - | 中 | 4 | T3-004 |
| T4-009 | 負荷テスト | - | 中 | 4 | T3-004 |
| T4-010 | セキュリティ監査 | - | 高 | 4 | T3-004 |

**合計工数**: 約41時間（5-6日）

#### 3.4.2 詳細タスク

**T4-001: パフォーマンス最適化**
- プロファイリング
- ボトルネックの特定と改善
- メモリ使用量の最適化

**T4-002: 並列検索実装**
- 複数クエリの並列実行
- 非同期処理の実装

**T4-003: キャッシュ機能実装**
- 検索結果のキャッシュ
- 重複検索の回避

**T4-004: ストリーミング出力実装**
- レポート生成のストリーミング
- Server-Sent Events (SSE)の実装

**T4-005: 認証機能実装**
- API Key認証
- JWT認証（オプション）

**T4-006: レート制限実装**
- エンドポイント別のレート制限
- Redisを使用したレート制限

**T4-007: Webhook実装**
- リサーチ完了時のWebhook送信
- イベント管理

**T4-008: 監視・アラート設定**
- メトリクス収集
- アラート設定
- ダッシュボード構築

**T4-009: 負荷テスト**
- 負荷テストの実施
- パフォーマンス測定
- スケーラビリティの確認

**T4-010: セキュリティ監査**
- セキュリティ脆弱性の確認
- セキュリティベストプラクティスの適用

#### 3.4.3 マイルストーン

- **M4-1**: パフォーマンス最適化完了（Week 5, Day 1-2）
- **M4-2**: セキュリティ対応完了（Week 5, Day 3）
- **M4-3**: 本番環境準備完了（Week 6）

---

## 4. タスク依存関係図

```
フェーズ1（基盤構築）
├── T1-001: プロジェクトセットアップ
│   ├── T1-002: データモデル実装
│   ├── T1-003: 設定管理実装
│   ├── T1-004: ロギング機能実装
│   └── T1-005: ステートスキーマ定義
└── T1-006: ユニットテスト（データモデル）

フェーズ2（コア機能）
├── T2-001: プロンプトテンプレート実装
├── T2-002: 検索ツール実装
├── T2-003: スクレイピングツール実装
├── T2-004: Supervisorノード実装
│   └── T2-008: エラーハンドリング実装
├── T2-005: Researcherノード実装
│   └── T2-008: エラーハンドリング実装
├── T2-006: Writerノード実装
│   └── T2-008: エラーハンドリング実装
├── T2-007: Reviewerノード実装
│   └── T2-008: エラーハンドリング実装
├── T2-009: グラフ構築・ルーティング実装
├── T2-010: ユニットテスト（ノード）
└── T2-011: 統合テスト（基本フロー）

フェーズ3（統合・API）
├── T3-001: チェックポイント機能実装
├── T3-002: Human-in-the-Loop実装
├── T3-003: APIスキーマ実装
├── T3-004: FastAPI実装
│   ├── T3-005: APIテスト実装
│   └── T3-006: エンドツーエンドテスト
└── T3-007: ドキュメント整備

フェーズ4（最適化・拡張）
├── T4-001: パフォーマンス最適化
├── T4-002: 並列検索実装
├── T4-003: キャッシュ機能実装
├── T4-004: ストリーミング出力実装
├── T4-005: 認証機能実装
├── T4-006: レート制限実装
├── T4-007: Webhook実装
├── T4-008: 監視・アラート設定
├── T4-009: 負荷テスト
└── T4-010: セキュリティ監査
```

---

## 5. 工数見積もり

### 5.1 フェーズ別工数

| フェーズ | タスク数 | 合計工数（時間） | 合計工数（日） | バッファ（20%） |
|---------|---------|----------------|--------------|----------------|
| フェーズ1 | 6 | 16 | 2 | 2.4日 |
| フェーズ2 | 11 | 58 | 7-8 | 9.6日 |
| フェーズ3 | 7 | 30 | 4 | 4.8日 |
| フェーズ4 | 10 | 41 | 5-6 | 7.2日 |
| **合計** | **34** | **145** | **18-20** | **23.6日** |

### 5.2 機能別工数

| 機能ID | 機能名 | 工数（時間） | 優先度 |
|--------|--------|------------|--------|
| F001 | ステート管理機能 | 3 | 高 |
| F002 | Supervisorノード機能 | 8 | 高 |
| F003 | Researcherノード機能 | 6 | 高 |
| F004 | Writerノード機能 | 6 | 高 |
| F005 | Reviewerノード機能 | 6 | 高 |
| F006 | グラフ構築・ルーティング機能 | 6 | 高 |
| F007 | 検索ツール機能 | 4 | 高 |
| F008 | スクレイピングツール機能 | 3 | 中 |
| F009 | チェックポイント機能 | 4 | 中 |
| F010 | Human-in-the-Loop機能 | 4 | 中 |
| F011 | エラーハンドリング機能 | 4 | 高 |
| F012 | ロギング・可観測性機能 | 2 | 中 |

---

## 6. リスク管理

### 6.1 リスク一覧

| リスクID | リスク内容 | 影響度 | 発生確率 | 対策 |
|---------|-----------|--------|---------|------|
| R001 | LangGraph/LangChainのAPI変更 | 高 | 中 | 最新ドキュメントを確認、バージョン固定 |
| R002 | Tavily APIのレート制限 | 中 | 中 | レート制限の実装、リトライロジック |
| R003 | LLM呼び出しのコスト超過 | 中 | 中 | コスト監視、トークン数の制限 |
| R004 | パフォーマンス問題 | 中 | 中 | プロファイリング、最適化 |
| R005 | テストカバレッジ不足 | 低 | 中 | テスト計画の徹底、コードレビュー |
| R006 | セキュリティ脆弱性 | 高 | 低 | セキュリティ監査、ベストプラクティス適用 |
| R007 | スケジュール遅延 | 中 | 中 | バッファの確保、優先順位の明確化 |

### 6.2 リスク対策

**R001: LangGraph/LangChainのAPI変更**
- 対策: バージョンを固定（requirements.txt）
- 監視: 定期的にドキュメントを確認
- エスカレーション: API変更時は設計書を更新

**R002: Tavily APIのレート制限**
- 対策: レート制限の実装、指数バックオフ
- 監視: API呼び出し回数の監視
- エスカレーション: レート制限到達時の通知

**R003: LLM呼び出しのコスト超過**
- 対策: トークン数の制限、コスト監視
- 監視: 使用量の追跡
- エスカレーション: 予算超過時のアラート

---

## 7. 品質管理

### 7.1 コード品質基準

- **テストカバレッジ**: 75%以上
- **型ヒント**: すべての関数に型ヒントを付与
- **ドキュメント**: すべての関数にdocstringを記述
- **リント**: flake8, mypyを使用
- **コードレビュー**: すべてのPRでコードレビューを実施

### 7.2 テスト戦略

- **ユニットテスト**: 各機能の個別テスト
- **統合テスト**: グラフ全体の実行フロー
- **APIテスト**: すべてのエンドポイントのテスト
- **エンドツーエンドテスト**: 実際のテーマでのレポート生成

### 7.3 レビューチェックリスト

- [ ] コードが設計書に準拠しているか
- [ ] テストが実装されているか
- [ ] エラーハンドリングが適切か
- [ ] ログ出力が適切か
- [ ] ドキュメントが充実しているか
- [ ] セキュリティ上の問題がないか

---

## 8. 開発環境

### 8.1 必要な環境

- **Python**: 3.10以上
- **IDE**: VS Code / PyCharm
- **バージョン管理**: Git
- **仮想環境**: venv / poetry

### 8.2 必要なAPIキー

- **OpenAI API Key**: GPT-4oの使用
- **Tavily API Key**: 検索APIの使用
- **Redis** (オプション): チェックポイント用

### 8.3 開発ツール

- **テストフレームワーク**: pytest
- **リント**: flake8, mypy
- **フォーマッター**: black
- **型チェック**: mypy
- **カバレッジ**: pytest-cov

---

## 9. マイルストーン

### 9.1 主要マイルストーン

| マイルストーン | 目標日 | 成果物 | 承認基準 |
|--------------|--------|--------|---------|
| M1: 基盤構築完了 | Week 1終了 | データモデル、設定管理、ロギング | ユニットテスト通過 |
| M2: コア機能完了 | Week 3終了 | 全ノード実装、グラフ構築 | 基本フローが動作 |
| M3: API実装完了 | Week 4終了 | FastAPI実装、チェックポイント | APIテスト通過 |
| M4: システム完成 | Week 6終了 | 最適化、セキュリティ対応 | エンドツーエンドテスト通過 |

### 9.2 中間マイルストーン

- **M1-1**: プロジェクトセットアップ完了
- **M1-2**: データモデル実装完了
- **M2-1**: ツール実装完了
- **M2-2**: ノード実装完了
- **M2-3**: グラフ構築完了
- **M2-4**: 基本フロー動作確認
- **M3-1**: チェックポイント機能完了
- **M3-2**: API実装完了
- **M3-3**: システム完成
- **M4-1**: パフォーマンス最適化完了
- **M4-2**: セキュリティ対応完了
- **M4-3**: 本番環境準備完了

---

## 10. 進捗管理

### 10.1 進捗報告

- **日次**: タスクの進捗を記録
- **週次**: マイルストーンの達成状況を報告
- **フェーズ終了時**: 成果物のレビューと承認

### 10.2 進捗トラッキング

以下の項目を追跡：

- **完了タスク数**: 完了したタスクの数
- **残りタスク数**: 残りのタスクの数
- **工数実績**: 実際にかかった工数
- **バグ数**: 発見されたバグの数
- **テストカバレッジ**: 現在のテストカバレッジ

### 10.3 進捗ダッシュボード（推奨）

以下のツールを使用して進捗を可視化：

- **GitHub Projects**: タスク管理
- **Jira**: プロジェクト管理（オプション）
- **Notion**: ドキュメント管理（オプション）

---

## 11. デリバリー計画

### 11.1 リリース計画

| バージョン | リリース日 | 内容 |
|-----------|----------|------|
| v0.1.0 | Week 1終了 | 基盤構築完了（内部リリース） |
| v0.2.0 | Week 3終了 | コア機能実装完了（内部リリース） |
| v0.3.0 | Week 4終了 | API実装完了（ベータリリース） |
| v1.0.0 | Week 6終了 | 正式リリース |

### 11.2 デプロイメント計画

**ステージング環境**:
- Week 4終了時にデプロイ
- エンドツーエンドテストの実施

**本番環境**:
- Week 6終了時にデプロイ
- 段階的なロールアウト
- モニタリングの強化

---

## 12. 変更管理

### 12.1 変更管理プロセス

1. **変更要求の提出**: IssueまたはPRで変更要求を提出
2. **影響分析**: 変更による影響を分析
3. **承認**: ステークホルダーの承認
4. **実装**: 変更を実装
5. **テスト**: 変更に対するテストを実施
6. **デプロイ**: 変更をデプロイ

### 12.2 変更履歴の管理

- **Git**: すべての変更をコミット
- **CHANGELOG.md**: 変更履歴を記録
- **バージョン管理**: セマンティックバージョニング

---

## 13. コミュニケーション計画

### 13.1 定例ミーティング

- **日次スタンドアップ**: 15分（進捗共有）
- **週次レビュー**: 1時間（成果物のレビュー）
- **フェーズ終了時レビュー**: 2時間（フェーズの振り返り）

### 13.2 コミュニケーションツール

- **Slack / Teams**: 日常的なコミュニケーション
- **GitHub Issues**: タスク管理、バグ報告
- **GitHub Pull Requests**: コードレビュー
- **ドキュメント**: Notion / Confluence

---

## 14. 成功基準

### 14.1 機能的な成功基準

- [ ] すべてのノードが正常に動作する
- [ ] 基本的なリサーチフローが動作する
- [ ] APIが正常に動作する
- [ ] テストカバレッジが75%以上
- [ ] エンドツーエンドテストが通過する

### 14.2 非機能的な成功基準

- [ ] パフォーマンス要件を満たす（各ノードの実行時間）
- [ ] セキュリティ要件を満たす
- [ ] 可用性99%以上（API）
- [ ] エラー率5%以下
- [ ] ドキュメントが充実している

---

## 15. 付録

### 15.1 参考資料

- 要求定義書
- 基本設計書
- 詳細設計書
- API仕様書
- データモデル定義書
- テスト仕様書
- プロンプト設計書

### 15.2 ツール・ライブラリ

- **LangGraph**: グラフ構築
- **LangChain**: LLM連携
- **FastAPI**: API実装
- **Pydantic**: データモデル
- **pytest**: テストフレームワーク
- **Tavily**: 検索API

---

## 16. 変更履歴

| バージョン | 日付 | 変更内容 |
|-----------|------|---------|
| 1.0 | 2024-12-27 | 初版作成 |
| 1.1 | 2025-02-01 | .env_example 表記に統一、ドキュメント情報・変更履歴更新 |

